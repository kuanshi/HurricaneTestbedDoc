.. _lbl-testbed_AC_asset_description:

*****************
Asset Description
*****************

This section describes how a large-scale building inventory was constructed using a phased approach that 
augments tax assessor data, using machine learning and image processing to address errors/omissions and 
generate all attributes required for the corresponding loss assessment. It is emphasized that the intent 
is to demonstrate how an inventory could be constructed and not to address potential errors, omissions or 
inaccuracies in the source data, i.e., source data are assumed to be accurate and no additional quality 
assurance was conducted outside of addressing glaring omissions or errors.

In the process of assembling this inventory, a number of scripts were developed to facilitate the actions 
described in the following sections. While these scripts were not intended to be production-quality 
software and were written assuming a particular data format/endpoint which may change over time, they 
do provide an example of the type of operations necessary to assemble a building inventory and thus 
are made available at GitHub as an illustrative example.

Phase I: Attribute Definition
===============================

All the attributes required for loss estimation were first identified to develop the Building Inventory 
data model, which catalogs each attribute, its purpose, its format (alphanumeric, floating point number, 
etc.), the data source used to define that attribute and the field(s) needed from that data source, any 
transformations of that source data necessary to align with the units or conventions used in the Building 
Inventory, and any relevant details explaining notations, assumptions, or reference documents.  These 
fields are summarized in :numref:`tab-bldgInventory` with full details of each field 
available on DesignSafe, for both the Atlantic County Inventory and the Flood-Exposed/Exploratory Inventory. 
The Building Inventory data model should be comprehensive, encompassing all attributes required for loss 
estimation, although these may be populated in the Building Inventory at different points in the workflow, 
e.g., a number of attributes needed for loss estimation are populated during the Asset Representation stage 
(see :ref:`lbl-testbed_AC_asset_representation`).

.. _tab-bldgInventory:

.. csv-table:: Building Inventory data model.
   :name: bldg_inv_dm
   :file: data/building_inventory_data_model_new.csv
   :header-rows: 1
   :align: center

Phase II: Footprint Selection
===============================

Inventory development initiated with the Footprint Data generated by the New Jersey Department of 
Environmental Protection (NJDEP). These NJDEP footprints include flood-exposed properties cataloged 
in two geodatabases encompassing approximately 453,000 footprints across the entire state:

1. **BF_NJDEP_20190612**: all building footprints within 1% annual chance (AC) floodplain, as defined by FEMA Flood
Insurance Rate Maps (FIRMs).

2. **02pct_20190520 Building_Footprints_02pct**: buildings that are not in the first dataset but fall within a
200-ft buffer of the 1% AC floodplain boundary.

These databases were then combined, with only properties within the limits of Atlantic County retained to form 
the Flood-Exposed Inventory. This inventory was then extended to include other footprints within the county 
boundaries. Microsoft (MS) Footprint Database was utilized as the primary source of Non-NJDEP footprint polygons.
One observed shortcoming of the MS Footprint Database is it incorrectly lumps together the footprints of closely 
spaced buildings. This issue was resolved by a combination of manual inspections and applying a separate roof 
segmentation algorithm to the satellite images obtained for the buildings. This resulted in the Atlantic County 
Inventory.

Phase III: Augmentation Using Third-Party Data
================================================

Attributes were then parsed from third-party data providers to populate all required attributes in the Building 
Inventory data model. For the Flood-Exposed Inventory, NJDEP had already enriched these footprints with various 
attributes necessary to conduct standard FEMA risk assessments. Specifically, all footprints included a set of 
Basic Attributes (:numref:`tab-basicAttri`). A subset of the data, including Atlantic County, had additional Advanced 
Attributes required by HAZUS User Defined Facilities (UDF) Module (:numref:`tab-udfAttri`) and FEMA Substantial Damage 
Estimator (SDE) Tool (:numref:`tab-sdeAttri`).

.. _tab-basicAttri:

.. csv-table:: NJDEP basic attributes available for all properties in Flood-Exposed Inventory.
   :file: data/basic_attributes.csv
   :header-rows: 1
   :align: center

.. _tab-udfAttri:

.. csv-table:: Advanced attributes for HAZUS User Defined Facilities (UDF), available for all properties in Flood-Exposed Inventory.
   :file: data/udf_attributes.csv
   :header-rows: 1
   :align: center

.. _tab-sdeAttri:

.. csv-table:: Advanced attributes for FEMA Substantial Damage Estimator (SDE) Tool, available for all properties in Flood-Exposed Inventory.
   :name: sde_attri
   :file: data/sde_attributes.csv
   :header-rows: 1
   :align: center

For the Atlantic County Inventory, any buildings not included in the NJDEP footprints had attributes encompassed 
by NJDEP Basic, UDF or SDE fields assigned by parsing New Jersey Tax Assessor Data (called **MODIV**) as defined in 
the MODIV User Manual. This notably affected attributes such as OccupancyClass, BuildingType and FoundationType, 
whose rulesets (PDFs and Python scripts) are cross-referenced in Table 2.2.5. 
In all cases where attributes were derived from MODIV data, whose fields can be sparsely populated, default 
values were initially assigned to ensure that every footprint would have the attributes required to execute 
the workflow. These default values were selected using engineering judgement to represent the most common/likely 
attribute expected or conservatively from the perspective of anticipated losses (i.e., picking the more 
vulnerable attribute option). These initial assignments are then updated if additional data is available in 
**MODIV** to make a more faithful attribute assignment.

.. list-table:: Additional details for rulesets assigning attributes available only in NJDEP dataset
   :name: addinfo_ruleset_njdep
   :header-rows: 1
   :align: center

   * - Ruleset Name
     - Ruleset Definition Table
     - Python script
   * - Building Type Rulesets
     - `Building Type Rulesets.pdf <https://www.designsafe-ci.org/data/browser/projects/362517025966264811-242ac118-0001-012/MOD%20IV%20Transformations>`_
     - :download:`BuildingTypeRulesets <data/BuildingTypeRulesets.py>`
   * - Foundation Type Rulesets
     - `Foundation Type Rulesets.pdf <https://www.designsafe-ci.org/data/browser/projects/362517025966264811-242ac118-0001-012/MOD%20IV%20Transformations>`_
     - :download:`FoundationTypeRulesets <data/FoundationTypeRulesets.py>`
   * - Occupancy Type Rulesets
     - `Occupancy Type Rulesets <https://www.designsafe-ci.org/data/browser/projects/362517025966264811-242ac118-0001-012/MOD%20IV%20Transformations>`_
     - :download:`OccupancyTypeRulesets <data/OccupancyTypeRulesets.py>`

Some attributes in the Building Inventory Data Model were not encompassed by NJDEP Basic, UDF or SDE fields, thus 
remaining attributes in both the Flood-Exposed and Atlantic County Inventories were assigned using data 
from the following third-party sources:
1. **Locations of essential facilities** were sourced from NJ Office of Information Technology (part of NJGIN Open Data [NJGIN20]_)
2. **ATC Hazards** by Location API ([ATC20]_) was used to query Design Wind Speeds as defined in ASCE 7 
3. **Terrain features** (roughness length associated with different exposure classes) was derived from Land Use Land Cover data (part of NJGIN Open Data [NJGIN20]_)

See the Transformation and Detail columns in the PDFs listed in :numref:`tab-bldgInventory` for specifics of how each attribute 
was assigned using these various third-party data sources.

Phase IV: Augmentation Using Image Processing
===============================================

A number of required attributes pertaining to externally-visible features of the building were either not 
included in the NJDEP footprints or MODIV data or were included but warranted cross validation. 
The methodology used for each of these attributes is now described.

1. **Number of Stories**: This attribute was available in state inventory data but was cross-validated.
2. **Building Elevations**: Building elevations are not available in state inventory data and required for both 
                           wind and flood loss modeling. The elevation of the bottom plane of the roof (lowest edge 
                           of roof line), elevation of the roof (peak of gable or apex of hip), and height of top of 
                           floor as estimated from base of door’s height, all defined with respect to grade (in feet), 
                           were estimated from streetview imagery. These geometric properties are defined visually 
                           for common residential coastal typologies in :numref:`building_elevation`. The mean height of the roof system 
                           is then derived from the aforementioned roof elevations.
                            
                           .. figure:: figure/building_elevation.png
                              :name: building_elevation
                              :align: center
                              :figclass: align-center
                              :figwidth: 1200

                              Interpolated peak wind speed (3s-gust) for each asset in the inventory.
3. **Roof Geometry**: Roof shape and slope are not available in state inventory data and required for wind loss 
                      modeling. The SimCenter developed application Building Recognition using Artificial 
                      Intelligence at Large Scales, BRAILS ([Wang19]_), is used to interpret satellite images 
                      of building roofs, which are collected from Google Maps. The satellite images are labeled 
                      with shape types to form a dataset, upon which a Convolutional Neural Network (CNN) is 
                      trained so that it can give rapid predictions of roof types when given new images of roofs. 
                      Microsoft Building Footprint data ([Microsoft2018]_) is used as the location index when downloading images 
                      automatically from Google Maps. While more complex roof shapes could in theory be classified, 
                      the current use of HAZUS damage and loss functions required the use of similitude measures 
                      to define each roof as an “effective” gable, hip or flat geometry. Using BRAILS, this 
                      classification was achieved with approximately 85% accuracy based on validation studies.
4. **Window Area**: The proportion of windows to the overall surface area is not available in state inventory data 
                    and required for wind loss modeling. Generally, window area can be assumed based on the 
                    building occupancy class given Department of Energy industry databases. This property can also 
                    be estimated from Google streetview imagery, under the assumption that the proportion of 
                    surface area occupied by windows at the front of the building is representative of the amount 
                    of window openings on the sides and rear of the building, an assumption that may hold for 
                    single family residential buildings, but possibly not for other commercial construction where 
                    street fronts have higher proportions of glass.

.. note::

   The process of constructing the **Atlantic County Inventory** for footprints beyond those in the 
   **Flood-Exposed Inventory** underscored a number of tasks/issues that are commonly encountered when constructing an inventory 
   in a location with sparse inventory data. Recommended best practices are summarized in :ref:`lbl-testbed_AC_best_practices`.

Populated Inventories
========================

Executing this four-phase process resulted in the assignment of all required attributes at the asset description 
stage of the workflow for both the **Atlantic County Inventory** and the **Flood-Exposed Inventory**. 
Table 2.2.6 and :numref:`bldg_inv_fei` provide respective examples of each of these inventories. 
The Flood-Exposed Inventory then was used to extract out the subset of buildings defining the  
**Exploration Inventory** (see example in :numref:`bldg_inv_ei`). The full inventories can be downloaded 
:download:`here <data/full_inventories.zip>`.

.. csv-table:: Illustrative sample of building in Flood-Exposed Inventory.
   :name: bldg_inv_fei
   :file: data/example_inventory.csv
   :header-rows: 1
   :align: center

.. csv-table:: Illustrative sample of building in Exploration Inventory.
   :name: bldg_inv_ei
   :file: data/example_inventory_exploration.csv
   :header-rows: 1
   :align: center

.. [ATC20]
   ATC (2020b), ATC Hazards By Location, https://hazards.atcouncil.org/, Applied Technology Council, Redwood City, CA.

.. [NJGIN20]
   NJ Geographic Information Network, State of New Jersey, https://njgin.nj.gov/njgin/#!/

.. [Wang19]
   Wang C. (2019), NHERI-SimCenter/SURF: v0.2.0 (Version v0.2.0). Zenodo. http://doi.org/10.5281/zenodo.3463676

.. [Microsoft2018]
   Microsoft (2018) US Building Footprints. https://github.com/Microsoft/USBuildingFootprints


